{% extends "marketing_base.html" %}

{% load i18n tz %}

{% block content %}
  <article class="blog-article">
    <section class="blog-hero py-5 py-lg-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-12 col-xl-8">
            <div class="d-flex flex-column gap-3">
              <div class="d-flex align-items-center gap-3 flex-wrap">
                {% if blog_post.status == 0 and request.user.is_staff %}
                  <span class="badge text-bg-warning-subtle text-warning-emphasis">
                    {% trans "Draft" %}
                  </span>
                {% endif %}
                <span class="text-muted small text-uppercase fw-semibold">
                  {% trans "Blog" %}
                </span>
              </div>
              <h1 class="display-5 fw-semibold mb-0">
                {{ blog_post.title }}
              </h1>
              <div class="blog-article__meta d-flex flex-column flex-md-row gap-2 align-items-md-center text-muted">
                <span>
                  {% trans "By" %}
                  {% if blog_post.author and blog_post.author.name %}
                    {{ blog_post.author.name }}
                  {% elif blog_post.author %}
                    {{ blog_post.author.username }}
                  {% else %}
                    {% trans "SimpleValidations Team" %}
                  {% endif %}
                </span>
                <span class="d-none d-md-inline">&middot;</span>
                <time datetime="{{ blog_post.published_on|localtime|date:'c' }}">
                  {{ blog_post.published_on|localtime|date:"DATE_FORMAT" }}
                </time>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="container pb-5 pb-lg-5">
      <div class="row justify-content-center">
        <div class="col-12 col-xl-8">
          {% if blog_post.featured_image %}
            <figure class="blog-article__figure mb-5">
              <img src="{{ blog_post.featured_image.url }}"
                   alt="{{ blog_post.featured_image_alt|default:blog_post.title }}"
                   class="img-fluid rounded-4 w-100 shadow-sm" />
              {% if blog_post.featured_image_credit %}
                <figcaption class="text-muted small mt-2">
                  {{ blog_post.featured_image_credit|safe }}
                </figcaption>
              {% endif %}
            </figure>
          {% endif %}

          <div class="blog-article__content prose">
            {{ blog_post.content|safe }}
          </div>

          <div class="mt-5">
            <a class="btn btn-outline-primary"
               href="{% url 'marketing:blog:blog_list' %}">
              &larr; {% trans "Back to blog" %}
            </a>
          </div>
        </div>
      </div>
    </section>

    {% if related_posts %}
      <section class="container pb-5">
        <div class="row justify-content-center">
          <div class="col-12 col-xl-8">
            <h2 class="h4 fw-semibold mb-4">
              {% trans "Keep reading" %}
            </h2>
          </div>
        </div>
        <div class="row g-4 g-lg-5">
          {% for related in related_posts %}
            <div class="col-12 col-md-6 col-xl-4">
              <article class="blog-card h-100 d-flex flex-column">
                <a class="blog-card__image ratio ratio-16x9"
                   href="{% url 'marketing:blog:blog_post_detail' related.slug %}">
                  {% if related.featured_image %}
                    <img src="{{ related.featured_image.url }}"
                         alt="{{ related.featured_image_alt|default:related.title }}"
                         class="img-fluid object-fit-cover" />
                  {% else %}
                    <div class="blog-card__placeholder d-flex align-items-center justify-content-center">
                      <span class="fw-semibold">{% trans "SimpleValidations" %}</span>
                    </div>
                  {% endif %}
                </a>
                <div class="blog-card__body d-flex flex-column flex-grow-1">
                  <div class="blog-card__meta d-flex align-items-center gap-2 mb-2">
                    <span class="text-muted small">
                      {% if related.author and related.author.name %}
                        {{ related.author.name }}
                      {% elif related.author %}
                        {{ related.author.username }}
                      {% else %}
                        {% trans "SimpleValidations Team" %}
                      {% endif %}
                    </span>
                    <span class="text-muted small">&middot;</span>
                    <time class="text-muted small"
                          datetime="{{ related.published_on|localtime|date:'c' }}">
                      {{ related.published_on|localtime|date:"DATE_FORMAT" }}
                    </time>
                  </div>
                  <h3 class="h5 fw-semibold mb-2">
                    <a class="text-decoration-none"
                       href="{% url 'marketing:blog:blog_post_detail' related.slug %}">
                      {{ related.title }}
                    </a>
                  </h3>
                  <p class="text-muted mb-3">
                    {{ related.content|striptags|truncatechars:140 }}
                  </p>
                  <div class="mt-auto">
                    <span class="blog-card__read-more fw-semibold">
                      {% trans "Read more" %} &rarr;
                    </span>
                  </div>
                </div>
              </article>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </article>
{% endblock content %}
