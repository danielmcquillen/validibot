{% load i18n core_tags %}

{% with view_name=request.resolver_match.view_name %}
  <div class="app-sidebar-inner">
    <div class="app-sidebar-brand">
      <a href="{% url 'marketing:home' %}"
         class="app-sidebar-brand-link">
        <span class="app-sidebar-brand-mark">SV</span>
        <span class="app-sidebar-brand-text">SimpleValidations</span>
      </a>
    </div>

    <div class="app-sidebar-nav">
      {% if active_org %}
        <div class="app-nav-section" role="group" aria-label="{% trans 'Organization navigation' %}">
          <div class="app-nav-section-heading text-uppercase small text-muted">
            {{ active_org.name }}
          </div>
          {% if is_org_admin %}
            <ul class="nav flex-column app-nav-list" role="menu">
              <li class="nav-item" role="none">
                <a href="{% org_url 'users:organization-update' pk=active_org.id %}"
                   class="nav-link app-nav-link{% if view_name == 'users:organization-update' %} active{% endif %}"
                   role="menuitem"
                   data-app-sidebar-link>
                  <i class="bi bi-gear"></i>
                  <span>{% trans "Organization settings" %}</span>
                </a>
              </li>
              <li class="nav-item" role="none">
                <a href="{% org_url 'users:organization-detail' pk=active_org.id %}"
                   class="nav-link app-nav-link{% if view_name == 'users:organization-detail' or view_name == 'users:organization-member-update' or view_name == 'users:organization-member-delete' %} active{% endif %}"
                   role="menuitem"
                   data-app-sidebar-link>
                  <i class="bi bi-people"></i>
                  <span>{% trans "Members" %}</span>
                </a>
              </li>
              <li class="nav-item" role="none">
                <a href="{% org_url 'projects:project-list' %}"
                   class="nav-link app-nav-link {% active_link 'projects' %}"
                   role="menuitem"
                   data-app-sidebar-link>
                  <i class="bi bi-kanban"></i>
                  <span>{% trans "Projects" %}</span>
                </a>
              </li>
              <li class="nav-item" role="none">
                <a href="{% org_url 'billing:usage-and-billing' %}"
                   class="nav-link app-nav-link{% if view_name == 'billing:usage-and-billing' %} active{% endif %}"
                   role="menuitem"
                   data-app-sidebar-link>
                  <i class="bi bi-credit-card"></i>
                  <span>{% trans "Usage & Billing" %}</span>
                </a>
              </li>
            </ul>
          {% endif %}

          {% if org_memberships|length > 1 %}
            <div class="app-nav-subsection">
              <div class="app-nav-subsection-heading text-uppercase small text-muted">
                {% trans "Switch organization" %}
              </div>
              <ul class="app-nav-switch" role="menu">
                {% for membership in org_memberships %}
                  <li role="none">
                    <form method="post"
                          action="{% url 'users:organization-switch' membership.org_id %}"
                          class="w-100">
                      {% csrf_token %}
                      <input type="hidden"
                             name="next"
                             value="{{ request.get_full_path }}" />
                      <button type="submit"
                              class="app-nav-button{% if membership.org_id == active_org.id %} active{% endif %}"
                              {% if membership.org_id == active_org.id %}
                                disabled aria-current="true"
                              {% endif %}
                              data-app-sidebar-link>
                        <span class="text-truncate">{{ membership.org.name }}</span>
                        {% if membership.is_admin %}
                          <span class="badge text-bg-light text-uppercase ms-2">
                            {% trans "Admin" %}
                          </span>
                        {% endif %}
                      </button>
                    </form>
                  </li>
                {% empty %}
                  <li class="text-muted small" role="none">
                    {% trans "No organizations available" %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
      {% endif %}

      <div class="app-nav-section" role="group" aria-label="{% trans 'Product navigation' %}">
        <ul class="nav flex-column app-nav-list" role="menu">
          <li class="nav-item" role="none">
            <a href="{% org_url 'dashboard:my_dashboard' %}"
               class="nav-link app-nav-link {% active_link 'dashboard' %}"
               role="menuitem"
               data-app-sidebar-link>
              <i class="bi bi-speedometer2"></i>
              <span>{% trans "Dashboard" %}</span>
            </a>
          </li>
          <li class="nav-item" role="none">
            <a href="{% org_url 'workflows:workflow_list' %}"
               class="nav-link app-nav-link {% active_link 'workflows' %}"
               role="menuitem"
               data-app-sidebar-link>
              <i class="bi bi-diagram-3"></i>
              <span>{% trans "Workflows" %}</span>
            </a>
          </li>
          <li class="nav-item" role="none">
            <a href="{% org_url 'validations:validation_list' %}"
               class="nav-link app-nav-link {% active_link 'validations' %}"
               role="menuitem"
               data-app-sidebar-link>
              <i class="bi bi-shield-check"></i>
              <span>{% trans "Validation Runs" %}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
{% endwith %}
