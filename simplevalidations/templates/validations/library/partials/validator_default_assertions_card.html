{% load i18n core_tags %}

<div id="validator-default-assertions-card">
  {% if assertions %}
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th scope="col" class="text-muted small">{% trans "Order" %}</th>
            <th scope="col" class="text-muted small">{% trans "Assertion" %}</th>
            <th scope="col" class="text-muted small">{% trans "Type" %}</th>
            <th scope="col" class="text-muted small">{% trans "Signals" %}</th>
            {% if can_edit_validator %}
              <th scope="col" class="text-muted small text-end">{% trans "Actions" %}</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for assertion in assertions %}
            <tr id="validator-assertion-{{ assertion.id }}">
              <td class="text-muted small">{{ assertion.order }}</td>
              <td class="fw-semibold">{{ assertion.name }}</td>
              <td class="text-muted small">{{ assertion.get_rule_type_display }}</td>
              <td class="text-muted small">
                {% if assertion.rule_entries.all %}
                  <div class="d-flex flex-wrap gap-1">
                    {% for link in assertion.rule_entries.all %}
                      <span class="badge bg-light text-dark border">{{ link.catalog_entry.slug }}</span>
                    {% endfor %}
                  </div>
                {% else %}
                  <span class="text-muted">â€”</span>
                {% endif %}
              </td>
              {% if can_edit_validator %}
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group" aria-label="{% trans 'Default assertion actions' %}">
                    <button class="btn btn-outline-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#modal-rule-edit-{{ assertion.id }}">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button class="btn btn-outline-primary"
                            hx-post="{% org_url 'validations:validator_rule_move' pk=assertion.validator_id rule_pk=assertion.id %}"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            hx-vals='{"direction": "up"}'
                            hx-target="#validator-default-assertions-card"
                            hx-swap="outerHTML"
                            {% if forloop.first %}disabled{% endif %}>
                      <i class="bi bi-arrow-up"></i>
                    </button>
                    <button class="btn btn-outline-primary"
                            hx-post="{% org_url 'validations:validator_rule_move' pk=assertion.validator_id rule_pk=assertion.id %}"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            hx-vals='{"direction": "down"}'
                            hx-target="#validator-default-assertions-card"
                            hx-swap="outerHTML"
                            {% if forloop.last %}disabled{% endif %}>
                      <i class="bi bi-arrow-down"></i>
                    </button>
                    <button class="btn btn-outline-danger"
                            hx-delete="{% org_url 'validations:validator_rule_delete' pk=assertion.validator_id rule_pk=assertion.id %}"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            hx-target="#validator-assertion-{{ assertion.id }}"
                            hx-swap="outerHTML"
                            hx-confirm="{% blocktrans trimmed with name=assertion.name %}Delete default assertion '{{ name }}'?{% endblocktrans %}">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted mb-0">{% trans "No default assertions yet." %}</p>
  {% endif %}
</div>
