{% load i18n %}

{% comment %}
This template lists out the summary results of the validation workflow run.
(It doesn't show step-by-step findings; those are in a different block.)
{% endcomment %}

<div class="card validation-info-card">
    <div class="card-header">
        {% trans "Run Summary" %}
    </div>
    <div class="card-body">

        {% comment %}
        {% if run.error %}
            <div class="alert alert-danger small w-100 text-center" role="alert">
                <i class="bi-exclamation-octagon me-2"></i>{{ run.error }}
            </div>
        {% endif %}
        {% endcomment %}

        <dl class="row mb-3 small">

            <dt class="col-5 col-lg-4">
                {% trans "Source" %}
            </dt>
            <dd class="col-7 col-lg-8">
                {{ run.get_source_display }}
            </dd>

            {% with summary_record=run.summary_record %}
                {% if summary_record %}

                    <dt class="col-5 col-lg-4">
                        {% trans "Errors" %}
                    </dt>
                    <dd class="col-7 col-lg-8">
                        <span class="badge text-bg-danger">{{ summary_record.error_count|default:"0" }}</span>
                    </dd>

                    <dt class="col-5 col-lg-4">
                        {% trans "warnings" %}
                    </dt>
                    <dd class="col-7 col-lg-8">
                        <span class="badge text-bg-warning text-dark">{{ summary_record.warning_count|default:"0" }}</span>
                    </dd>

                    <dt class="col-5 col-lg-4">
                        {% trans "info" %}
                    </dt>
                    <dd class="col-7 col-lg-8">
                        <span class="badge text-bg-info text-dark">{{ summary_record.info_count|default:"0" }}</span>
                    </dd>

                    <dt class="col-5 col-lg-4">
                        {% trans "Total findings" %}
                    </dt>
                    <dd class="col-7 col-lg-8">
                        {{ summary_record.total_findings }}
                    </dd>

                    <dt class="col-sm-4">
                        {% trans "Submission" %}
                    </dt>
                    <dd class="col-sm-8">
                        {{ validation.submission.name|default:validation.submission.pk }}
                    </dd>

                    <dt class="col-sm-4">
                        {% trans "Organization" %}
                    </dt>
                    <dd class="col-sm-8">
                        {{ validation.org.name }}
                    </dd>

                {% endif %}
            {% endwith %}
        </dl>

        <hr />
        <dl class="row mb-3 small">

            <dt class="col-5 col-lg-4 ">
                {% trans "Started" %}
            </dt>
            <dd class="col-7 col-lg-8">
                {{ run.started_at|date:"M j, Y g:i a"|default:_("Pending") }}
            </dd>

            <dt class="col-5 col-lg-4">
                {% trans "Completed" %}
            </dt>
            <dd class="col-7 col-lg-8">
                {{ run.ended_at|date:"M j, Y g:i a"|default:_("Pending") }}
            </dd>

            <dt class="col-5 col-lg-4">
                {% trans "Duration" %}
            </dt>
            <dd class="col-7 col-lg-8">
                {% with duration=run.computed_duration_ms %}
                    {% if duration %}
                        {{ duration|floatformat:0 }} ms
                    {% elif is_polling %}
                        <span class="text-muted">{% trans "Runningâ€¦" %}</span>
                    {% else %}
                        <span class="text-muted">{% trans "Not captured" %}</span>
                    {% endif %}
                {% endwith %}
            </dd>
        </dl>

    </div>
</div>
