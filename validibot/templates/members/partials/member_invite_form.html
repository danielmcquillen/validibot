{% load i18n core_tags %}

<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi-person-plus me-2"></i>{% trans "Invite Member" %}
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Close' %}"></button>
</div>
<form method="post"
      action="{% org_url 'members:invite_create' %}"
      hx-post="{% org_url 'members:invite_create' %}"
      hx-target="#member-invite-modal-content"
      hx-swap="innerHTML"
      novalidate>
  {% csrf_token %}
  <div class="modal-body">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{% trans 'Close' %}"></button>
        </div>
      {% endfor %}
    {% endif %}

    <p class="text-muted small mb-3">
      {% blocktrans with name=organization.name %}
        Invite someone to join "{{ name }}" as a member. They'll have access based on the roles you assign.
      {% endblocktrans %}
    </p>

    {% if invite_form.non_field_errors %}
      <div class="alert alert-danger" role="alert">
        {% for error in invite_form.non_field_errors %}
          {{ error }}<br />
        {% endfor %}
      </div>
    {% endif %}

    <div class="mb-3">
      <label class="form-label fw-semibold" for="{{ invite_form.search.id_for_label }}">
        {% trans "User or email" %}
      </label>
      <input type="text"
             name="search"
             class="form-control"
             value="{{ invite_form.data.search|default:'' }}"
             hx-get="{% org_url 'members:invite_search' %}"
             hx-target="#invite-search-results"
             hx-trigger="keyup changed delay:300ms"
             hx-include="[name=search]"
             placeholder="{% trans 'Type a username or email' %}" />
      <div id="invite-search-results" class="mt-2">
        {% include "members/partials/invite_search_results.html" with matches=None query=None %}
      </div>
    </div>

    <div class="mb-3">
      <span class="form-label fw-semibold d-block mb-2">{{ invite_form.fields.roles.label }}</span>
      {% if invite_form.roles.errors %}
        <div class="text-danger small mb-2">
          {% for error in invite_form.roles.errors %}
            {{ error }}<br />
          {% endfor %}
        </div>
      {% endif %}
      {% include "users/partials/role_checkbox_list.html" with role_options=invite_form.role_options field_name="roles" %}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
      {% trans "Cancel" %}
    </button>
    <button type="submit" class="btn btn-secondary">
      <i class="bi-send me-1"></i>{% trans "Send Invitation" %}
    </button>
  </div>
</form>
