{% load i18n %}

{#
  Shared alert template for invite notifications.
  Expected context:
    - notification: the Notification object
    - invite: the invite object (PendingInvite, GuestInvite, or WorkflowInvite)
    - invite_type: "member", "guest", or "workflow"
    - show_dismissed: whether to show dismissed notifications
#}
<div class="alert alert-info border alert-dismissible fade show d-flex justify-content-between align-items-start"
     role="alert">
  <div>
    <div class="fw-semibold mb-1">
      {% if invite_type == "member" %}
        {% blocktrans with org=invite.org.name %}Invitation to {{ org }}{% endblocktrans %}
      {% elif invite_type == "guest" %}
        {% blocktrans with org=invite.org.name %}Guest access invitation for {{ org }}{% endblocktrans %}
      {% elif invite_type == "workflow" %}
        {% blocktrans with workflow=invite.workflow.name %}Workflow invitation: {{ workflow }}{% endblocktrans %}
      {% else %}
        {% trans "Invitation" %}
      {% endif %}
    </div>
    <div class="text-muted small">
      {% if invite_type == "workflow" %}
        {% trans "Workflow:" %} {{ invite.workflow.name }}
        <br />
        {% trans "Organization:" %} {{ invite.workflow.org.name }}
      {% else %}
        {% trans "Organization:" %} {{ invite.org.name }}
      {% endif %}
    </div>
    <div class="text-muted small">{{ notification.created_at|date:"Y-m-d H:i" }}</div>
    {% if notification.payload.message %}<div class="mt-2 small">{{ notification.payload.message }}</div>{% endif %}
  </div>
  <div class="d-flex gap-2 align-items-start">
    {% if invite.is_pending and not notification.dismissed_at %}
      {# Accept button #}
      <form method="post"
            {% if invite_type == "member" %} action="{% url 'notifications:notification-invite-accept' notification.pk %}" hx-post="{% url 'notifications:notification-invite-accept' notification.pk %}" {% elif invite_type == "guest" %} action="{% url 'notifications:notification-guest-invite-accept' notification.pk %}" hx-post="{% url 'notifications:notification-guest-invite-accept' notification.pk %}" {% elif invite_type == "workflow" %} action="{% url 'notifications:notification-workflow-invite-accept' notification.pk %}" hx-post="{% url 'notifications:notification-workflow-invite-accept' notification.pk %}" {% endif %}
            hx-target="closest .alert"
            hx-swap="outerHTML">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-success">{% trans "Accept" %}</button>
      </form>
      {# Decline button #}
      <form method="post"
            {% if invite_type == "member" %} action="{% url 'notifications:notification-invite-decline' notification.pk %}" hx-post="{% url 'notifications:notification-invite-decline' notification.pk %}" {% elif invite_type == "guest" %} action="{% url 'notifications:notification-guest-invite-decline' notification.pk %}" hx-post="{% url 'notifications:notification-guest-invite-decline' notification.pk %}" {% elif invite_type == "workflow" %} action="{% url 'notifications:notification-workflow-invite-decline' notification.pk %}" hx-post="{% url 'notifications:notification-workflow-invite-decline' notification.pk %}" {% endif %}
            hx-target="closest .alert"
            hx-swap="outerHTML">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-secondary">{% trans "Decline" %}</button>
      </form>
    {% else %}
      <span class="badge {% if invite.status == "ACCEPTED" %} text-bg-success {% elif invite.status == "DECLINED" %} text-bg-secondary {% elif invite.is_expired %} text-bg-warning {% else %} text-bg-light {% endif %}">
        {% if invite.is_expired %}
          EXPIRED
        {% else %}
          {{ invite.status }}
        {% endif %}
      </span>
    {% endif %}
    {% if notification and notification.can_dismiss and not notification.dismissed_at %}
      <form method="post"
            hx-post="{% url 'notifications:notification-dismiss' notification.pk %}"
            hx-target="closest .alert"
            hx-swap="outerHTML">
        {% csrf_token %}
        {% if show_dismissed %}<input type="hidden" name="show_dismissed" value="on" />{% endif %}
        <button type="submit"
                class="btn-close"
                aria-label="{% trans 'Dismiss' %}"
                title="{% trans 'Dismiss notification' %}"></button>
      </form>
    {% elif notification and notification.dismissed_at %}
      <span class="text-muted small fst-italic">{% trans "(notification dismissed)" %}</span>
    {% endif %}
  </div>
</div>
