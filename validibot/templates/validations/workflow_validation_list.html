{% extends "app_base.html" %}

{% load i18n %}

{% block title %}
  {{ workflow.name }} · {% trans "Validations" %} · Validibot
{% endblock title %}

{% block left_sidebar %}
  {% include "app/partial/components/app_left_nav.html" %}
{% endblock left_sidebar %}

{% block app_content %}
  <div class="container-fluid" id="workflow-validation-list">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
      <div>
        <h1 class="h3 mb-1">
          {% trans "Validations for the" %} "{{ workflow.name }}" {% trans "validation" %}
        </h1>
        <p class="text-muted mb-0">
          {% trans "Recent runs that have executed against this workflow." %}
        </p>
      </div>
      <a class="btn btn-secondary"
         href="{% url 'workflows:workflow_detail' workflow.pk %}">
        <i class="bi-chevron-left me-1"></i>
        {% trans "Back to workflow" %}
      </a>
    </div>

    <div class="table-responsive shadow-sm rounded">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">
              {% trans "Run" %}
            </th>
            <th scope="col">
              {% trans "Status" %}
            </th>
            <th scope="col">
              {% trans "Started" %}
            </th>
            <th scope="col">
              {% trans "Completed" %}
            </th>
            <th scope="col" class="text-end">
              {% trans "Actions" %}
            </th>
          </tr>
        </thead>
        <tbody>
          {% for validation in validations %}
            <tr id="validation-row-{{ validation.pk }}">
              <td>
                #{{ validation.pk }}
              </td>
              <td>
                <span class="badge text-bg-secondary">{{ validation.get_status_display }}</span>
              </td>
              <td>
                {{ validation.started_at|date:"M j, Y g:i a"|default:_("Pending") }}
              </td>
              <td>
                {{ validation.ended_at|date:"M j, Y g:i a"|default:_("Pending") }}
              </td>
              <td class="text-end">
                <div class="btn-group btn-group-sm">
                  <a class="btn btn-secondary"
                     href="{% url 'validations:validation_detail' validation.pk %}">{% trans "View" %}</a>
                  <button type="button"
                          class="btn btn-danger"
                          hx-delete="{% url 'validations:validation_delete' run.pk %}"
                          hx-target="#validation-row-{{ validation.pk }}"
                          hx-swap="outerHTML"
                          hx-confirm="{% trans "Delete this validation run?" %}">
                    {% trans "Delete" %}
                  </button>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="text-center py-5 text-muted">
                {% trans "No validation runs yet for this workflow." %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock app_content %}
